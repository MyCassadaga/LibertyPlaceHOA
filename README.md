# Liberty Place HOA Management Platform (Phases 1–2)

The Liberty Place HOA portal modernises self-managed board tasks across multiple phases. Phase 1 delivered homeowner directory, billing, communications, contracts, and RBAC foundations. Phase 2 builds on that work with covenant violation workflows, compliance notices, enhanced reporting, and admin tooling. The stack remains FastAPI + SQLAlchemy + Alembic on the backend with a Vite + React + TypeScript frontend.

## Prerequisites

- Python 3.11+
- Node.js 18+ and npm (or pnpm/yarn if preferred)
- SQLite (bundled with Python) for local development

## Backend Setup

```bash
# 1. Create and activate a virtual environment
python3 -m venv .venv
source .venv/bin/activate  # Windows: .venv\\Scripts\\activate

# 2. Install Python dependencies
pip install --upgrade pip
pip install -r requirements.txt

# 3. Apply database migrations
alembic upgrade head

# 4. (One-time) create the initial SYSADMIN user
python backend/manage_create_admin.py --email admin@example.com --password changeme
python -m backend.manage_create_admin …
# 5. Run the FastAPI development server
uvicorn backend.main:app --reload --port 8000
```

The API is served at `http://localhost:8000`. Interactive docs live at `/docs`.

## Frontend Setup

```bash
cd frontend
npm install
npm run dev
```

The Vite dev server runs on `http://localhost:5174`.

## One-Step Local Launch

Once dependencies are installed, you can bring up both servers (and apply migrations) with:

```bash
python3 scripts/start_dev.py
```

This launcher runs Alembic migrations, starts `uvicorn` on port 8001, and kicks off the Vite dev server on port 5174. Press `Ctrl+C` to stop both processes together.

### Seeding quick test data

To add a contract for renewal reminder testing, use:

```bash
python3 scripts/add_contract.py --vendor "ACME Landscaping" --service "Landscaping" \
  --start 2024-01-01 --end 2024-12-31 --notice-deadline 2024-12-01 --auto-renew
```

Adjust dates and fields as needed; the script writes directly to the dev database configured in `.env`.

## Default Roles & Access

Roles are seeded at startup (`SYSADMIN`, `BOARD`, `TREASURER`, `SECRETARY`, `ARC`, `AUDITOR`, `ATTORNEY`, `HOMEOWNER`). RBAC gates routers and actions based on minimum privileges. All sensitive operations create audit log entries.

## Initial Data Flow

1. Seed roles and create the first SYSADMIN using the management script.
2. SYSADMIN registers additional board, treasurer, and homeowner users through the `/auth/register` endpoint.
3. Homeowner registrations automatically create a placeholder owner record (lot `UNASSIGNED-<user id>`). Board/treasurer users can refine ownership details from the Owners page or via the owners API alongside contracts and invoicing tasks.
4. Homeowners log in to view invoices, request profile updates, and receive announcements generated by board members.

## Repository Layout

```
backend/        FastAPI app, SQLAlchemy models, services, Alembic migrations
frontend/       React + Vite + Tailwind UI
  src/pages     Feature pages (dashboard, billing, owners, contracts, communications)
  src/hooks     Client-side auth context
  src/services  REST API client
  src/components Layout and auth guards
  src/styles    Tailwind entry point
migrations/     Alembic migration scripts (inside backend/migrations)
docs/           Phase scope and extended documentation
```

## Phase 2 Highlights

- **Violations workflow**: New `/violations` API, Violation/FineSchedule/Notice/Appeal tables, and a board/homeowner page for tracking state transitions, notices, and appeals. Each transition writes to `AuditLog` and generates templated email/PDF notices as required.
- **ARC workflow**: `/arc` API with ARCRequest/Attachment/Condition/Inspection tables, file uploads stored in `uploads/arc`, state transitions, and comment threads surfaced in the new `/arc` page for homeowners and reviewers.
- **Bank reconciliation**: `/banking` API stores uploaded CSV statements, runs automatic matching against Payments/Invoices, tracks matched/unmatched transactions, and exposes a read-only reconciliation page for treasurers/board members.
- **SYSADMIN user management**: `/admin` UI lets sysadmins provision board/treasurer/auditor/homeowner accounts without calling the API manually.
- **Fine schedules**: Seeded defaults configure warning/fine escalation amounts. Frontend surfaces schedules when creating violations.
- **CSV reporting (Phase 1.5)**: `/reports/ar-aging.csv` and `/reports/cash-flow.csv` are live with RBAC enforcement and audit logging.
- **Resident roster & self-service profiles**: `/owners/residents` exposes a combined view of users and owner records, while `/auth/me`, `/auth/me/change-password`, and `/owners/me` let board members and homeowners manage email, passwords, and contact information directly from the new Account page.
- **Account archiving**: SYSADMINs can archive or restore owner records (`/owners/{id}/archive` / `/owners/{id}/restore`) which preserves historical data, frees the original lot for reassignment, deactivates linked logins, and removes archived owners from automated billing workflows.

## Key API Routes

- `GET /violations/` — list violations (board/treasurer/sysadmin/attorney/secretary) or current owner when logged in as homeowner.
- `POST /violations/` — board/sysadmin/secretary create new violation records.
- `POST /violations/{id}/transition` — apply allowed state transitions with automatic notices.
- `GET /violations/{id}/notices` — retrieve generated email/PDF notices.
- `POST /violations/{id}/appeals` — homeowners submit appeals; board can decide via `POST /violations/{id}/appeals/{appeal_id}/decision`.
- `GET /violations/fine-schedules` — retrieve configured fine schedules.
- `GET /owners/residents` — board/treasurer/secretary/sysadmin roster of every user and linked owner record.
- `PATCH /auth/me`, `POST /auth/me/change-password` — authenticated users update profile/email and rotate passwords.
- `PUT /owners/me` — homeowners (and any user linked to an owner record) update contact, address, and phone details.
- `POST /owners/{id}/archive`, `POST /owners/{id}/restore` — SYSADMIN workflows to freeze/reactivate an owner account (optionally reactivating linked logins on restore).
- `GET /reports/ar-aging`, `GET /reports/cash-flow` — financial CSV exports (BOARD/TREASURER/SYSADMIN).
- `GET /reports/violations-summary`, `GET /reports/arc-sla` — compliance and ARC SLA analytics CSVs.
- `/banking/reconciliations` & `/banking/transactions` — review bank statement imports, matched/unmatched items, and reconciliation details.

Frontend entry points: `/owner-profile` (Account settings for all roles), `/violations` (board + homeowner visibility), `/owners` (roster with archiving tools), and `/admin` (sysadmin only).

## Tests & Next Steps

- Add automated tests (pytest) around violation state transitions and notice generation.
- Integrate a production-grade email/PDF provider in place of the current stubs.
- Implement 2FA and persistent session storage as outlined in the full spec.
